<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<div layout:fragment="content" class="container my-3">
<head>
    <meta charset="UTF-8">
    <title>비밀번호 재설정</title>
    <style>
/*         body { font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f4f4f4; } */
/*         .reset-form { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); width: 300px; } */
/*         .reset-form h2 { text-align: center; } */
/*         .reset-form label, .reset-form input { display: block; width: 100%; margin-bottom: 10px; } */
/*         .reset-form input[type="password"] { padding: 8px; box-sizing: border-box; } */
/*         .reset-form button { width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; } */
    </style>
</head>
<body>

    <div class="reset-form">
        <h2>비밀번호 재설정</h2>
        
        <div th:if="${errorMessage}" class="alert alert-danger">
    <ul>
        <li th:each="error : ${errorMessage}" th:text="${error.defaultMessage}"></li>
    </ul>
</div>

<!--         <form action="/user/reset-password/setting" method="post"> -->

<!-- 밑에 자바스크립트에서 id불러서 강제로 경로지정 -->
			 <form id="reset-form" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <input type="hidden" id="uuid" name="uuid" value="{uuid}">
            
            <p>특수문자, 대문자를 1개이상 포함해야합니다.</p>
            <p>4글자 이상, 25글자 이하만 가능합니다.</p>
            <br>
            <label for="new-password" class="form-label">새 비밀번호</label>
            <input type="password" id="new-password" class="form-control" name="newPassword" required>
			<br>
            <label for="confirm-password" class="form-label">새 비밀번호 확인</label>
            <input type="password" id="confirm-password" class="form-control" name="newPasswordConfirm" required>
            <br>
            <button type="submit" class="btn btn-primary">비밀번호 변경</button>
        </form>
    </div>
<!--  이전 코드인데 url uuid 문제있어서 일단 닫아둠 -->
<!--     <script>
        // URL에서 UUID를 추출하는 로직
        const urlPath = window.location.pathname;
        const uuid = urlPath.substring(urlPath.lastIndexOf('/') + 1);
        document.getElementById('uuid').value = uuid;

        // 비밀번호 일치 여부 확인 (클라이언트 측 유효성 검사)
        document.querySelector('form').addEventListener('submit', function(event) {
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            if (newPassword !== confirmPassword) {
                alert('비밀번호가 일치하지 않습니다.');
                event.preventDefault();
            }
        });
    </script> -->
 
 
<!--  최신버전 -->
  <script th:inline="javascript">
        // URL에서 UUID를 추출하는 로직
        const urlPath = window.location.pathname;
        const uuid = urlPath.substring(urlPath.lastIndexOf('/') + 1);
        
        // 폼의 action URL을 동적으로 설정
        const form = document.getElementById('reset-form');
        form.action = '/user/reset-password/setting/' + uuid;
        
        var serverErrorMessage = /*[[${errorMessage}]]*/ null;
        
        // 메시지가 존재하면 alert 창 띄우기
        if (serverError) {
        	serverError.forEach(function(error) {
            alert(error.defaultMessage);
        	});
        }
   
// =======================================================================        
// 가독성 수정전 상태 놔둠

//         // 비밀번호 일치 여부 확인 (클라이언트 측 유효성 검사)
//         document.querySelector('form').addEventListener('submit', function(event) {
//         	const passwordPattern = /^(?=.*[A-Z])(?=.*[^A-Za-z0-9]).{4,}$/;
//             const newPassword = document.getElementById('new-password').value;
//             const confirmPassword = document.getElementById('confirm-password').value;
//             if (newPassword !== confirmPassword) {
//                 alert('비밀번호가 일치2222하지 않습니다.');
//                 event.preventDefault();
//                 return; //아래 코드 막기위해사용
//             }
//             if (!passwordPattern.test(newPassword)) {
//             	alert('4글자이상, / 특수문자, 대문자를 1개이상 써주세요.');
//                 event.preventDefault();            	
//             }
//         });
//         var errorMessage = /*[[${errorMessage}]]*/ null;

//         // errorMessage가 존재할 경우 경고창 팝업
//         if (errorMessage) {
//             alert(errorMessage);
//         }

// ========================================================================
	
	document.querySelector('form').addEventListener('submit', function(event) {
    const passwordPattern = /^(?=.*[A-Z])(?=.*[^A-Za-z0-9]).{4,}$/;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
});

//     let errorMessage = '';

//     // 1. 비밀번호 일치 여부 검사
//     if (newPassword !== confirmPassword) {
//         errorMessage = '비밀번호가 일치하지 않습니다.';
//     } 
//     // 2. 정규식 패턴 검사 (1번 검사가 통과했을 때만 실행)
//     else if (!passwordPattern.test(newPassword)) {
//         errorMessage = '비밀번호는 4글자 이상이며, 대문자와 특수문자를 각각 1개 이상 포함해야 합니다.';
//     }

    // 에러 메시지가 있을 경우에만 alert를 띄우고 제출을 막음
//     if (errorMessage) {
//         alert(errorMessage);
//         event.preventDefault();
//     }
// });
    </script>
</body>
</div>
</html>